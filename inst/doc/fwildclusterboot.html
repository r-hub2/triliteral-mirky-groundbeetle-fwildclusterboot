<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Alexander Fischer" />


<title>fwildclusterboot</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<style type="text/css">
.lightable-minimal {
border-collapse: separate;
border-spacing: 16px 1px;
width: 100%;
margin-bottom: 10px;
}
.lightable-minimal td {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal th {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal thead tr:last-child th {
border-bottom: 2px solid #00000050;
empty-cells: hide;
}
.lightable-minimal tbody tr:first-child td {
padding-top: 0.5em;
}
.lightable-minimal.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-minimal.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic {
border-top: 0.16em solid #111111;
border-bottom: 0.16em solid #111111;
width: 100%;
margin-bottom: 10px;
margin: 10px 5px;
}
.lightable-classic tfoot tr td {
border: 0;
}
.lightable-classic tfoot tr:first-child td {
border-top: 0.14em solid #111111;
}
.lightable-classic caption {
color: #222222;
}
.lightable-classic td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic thead tr:last-child th {
border-bottom: 0.10em solid #111111;
}
.lightable-classic.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic-2 {
border-top: 3px double #111111;
border-bottom: 3px double #111111;
width: 100%;
margin-bottom: 10px;
}
.lightable-classic-2 tfoot tr td {
border: 0;
}
.lightable-classic-2 tfoot tr:first-child td {
border-top: 3px double #111111;
}
.lightable-classic-2 caption {
color: #222222;
}
.lightable-classic-2 td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic-2 th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic-2 tbody tr:last-child td {
border-bottom: 3px double #111111;
}
.lightable-classic-2 thead tr:last-child th {
border-bottom: 1px solid #111111;
}
.lightable-classic-2.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic-2.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #EEE;
border-collapse: collapse;
margin-bottom: 10px;
}
.lightable-material tfoot tr td {
border: 0;
}
.lightable-material tfoot tr:first-child td {
border-top: 1px solid #EEE;
}
.lightable-material th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
}
.lightable-material td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
border-top: 1px solid #eeeeee;
}
.lightable-material.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody td {
border: 0;
}
.lightable-material.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #ddd;
}
.lightable-material-dark {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #FFFFFF12;
border-collapse: collapse;
margin-bottom: 10px;
background-color: #363640;
}
.lightable-material-dark tfoot tr td {
border: 0;
}
.lightable-material-dark tfoot tr:first-child td {
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF60;
}
.lightable-material-dark td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF;
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark.lightable-hover tbody tr:hover {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody tr:nth-child(even) {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody td {
border: 0;
}
.lightable-material-dark.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #FFFFFF12;
}
.lightable-paper {
width: 100%;
margin-bottom: 10px;
color: #444;
}
.lightable-paper tfoot tr td {
border: 0;
}
.lightable-paper tfoot tr:first-child td {
border-top: 1px solid #00000020;
}
.lightable-paper thead tr:last-child th {
color: #666;
vertical-align: bottom;
border-bottom: 1px solid #00000020;
line-height: 1.15em;
padding: 10px 5px;
}
.lightable-paper td {
vertical-align: middle;
border-bottom: 1px solid #00000010;
line-height: 1.15em;
padding: 7px 5px;
}
.lightable-paper.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-paper.lightable-striped tbody tr:nth-child(even) {
background-color: #00000008;
}
.lightable-paper.lightable-striped tbody td {
border: 0;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">fwildclusterboot</h1>
<h4 class="author">Alexander Fischer</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fwildclusterboot)</span></code></pre></div>
<p>The <code>fwildclusterboot</code> package implements the “fast” wild
cluster bootstrap algorithm developed in Roodman et al (2019) for
regression objects in R. The “fast” algorithm makes it feasible to
calculate test statistics based on a large number of bootstrap draws
even for large samples - as long as the number of bootstrapping clusters
is not too large.</p>
<p>For linear regression models, <code>fwildclusterboot</code> supports
almost all features of Stata’s <code>boottest</code> package. This means
that a set of different bootstrap distributions, regression weights,
fixed effects, and both restricted (WCR) and unrestricted (WCU)
bootstrap inference are supported. The main difference is that it
currently only supports univariate hypothesis tests of regression
paramters of the form <span class="math inline">\(H_{0}: R\beta =
r\)</span> vs <span class="math inline">\(H_{1}: R\beta \neq r\)</span>,
where r is scalar.</p>
<p>Further, <code>fwildclusterboot</code> serves as an R port to <a href="https://github.com/droodman/WildBootTests.jl">WildBootTests.jl</a>,
which implements the fast wild cluster bootstrap in Julia at extreme
speed. Beyond being significantly faster than
<code>fwildclusterboot&#39;s</code> native R implementation of the wild
cluster bootstrap for OLS (in particular for more demanding problems),
<code>WildBootTests.jl</code> offers support for the WRE bootstrap for
IV models (<a href="https://www.tandfonline.com/doi/abs/10.1198/jbes.2009.07221">(Davidson
&amp; MacKinnon, 2010)</a>) and functionality for tests of multiple
hypothesis.</p>
<p>A description of the “fast” algorithm is beyond the scope of this
vignette. It is very clearly presented in <a href="https://econpapers.repec.org/paper/qedwpaper/1406.htm">Roodman et
al. (2019)</a>. For technical details of the implementation in
<code>fwildclusterboot</code>, have a look at the
<code>technical vignette</code> (tba).</p>
<div id="the-boottest-function" class="section level1">
<h1>The <code>boottest()</code> function</h1>
<p>The <code>fwildclusterboot</code> package consists of one key
function, <code>boottest()</code>. It implements the fast wild bootstrap
and works with regression objects of type <code>lm</code>,
<code>felm</code> and <code>fixest</code> from base R and the
<code>lfe</code> and <code>fixest</code> packages.</p>
<p>To start, we create a random data set with two cluster variables
(group_id1 &amp; group_id2), two fixed effects and a set of covariates.
The <code>icc_</code> arguments control the cluster variable’s
intra-cluster correlation.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed via dqset.seed for engine = &quot;R&quot; &amp; Rademacher, Webb &amp; Normal weights</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dqrng<span class="sc">::</span><span class="fu">dqset.seed</span>(<span class="dv">2352342</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set &#39;familiar&#39; seed for all other algorithms and weight types </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23325</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># load data set voters included in fwildclusterboot</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(voters)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the regression model via lm</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  proposition_vote <span class="sc">~</span> treatment <span class="sc">+</span> ideology1 <span class="sc">+</span> log_income <span class="sc">+</span> Q1_immigration , </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> voters</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># model with interaction</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>lm_fit_interact <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  proposition_vote <span class="sc">~</span> treatment <span class="sc">+</span> ideology1 <span class="sc">+</span> log_income<span class="sc">:</span>Q1_immigration , </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> voters</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The <code>boottest()</code> function has 4 required and several
optional arguments. The required objects are</p>
<ul>
<li>object: a regression object of type <code>lm</code>,
<code>fixest</code> or <code>felm</code></li>
<li>clustid: a character vector that defines the clustering
variables</li>
<li>param: a character vector of length one - the model parameter to be
tested</li>
<li>B: the number of bootstrap iterations</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># boottest on an object of type lm</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>boot_lm <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Please note that the seeding behavior for random number generation for</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `boottest()` has changed with `fwildclusterboot` version 0.13.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; It will no longer be possible to exactly reproduce results produced by versions</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lower than 0.13.</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; If your prior results were produced under sufficiently many bootstrap</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; iterations, none of your conclusions will change.  For more details about this</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; change, please read the notes in</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [news.md](https://cran.r-project.org/web/packages/fwildclusterboot/news/news.html).</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once per session.</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; To guarantee reproducibility, don&#39;t forget to set a global random seed **both**</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; via `set.seed()` and `dqrng::dqset.seed()`.</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This message is displayed once every 8 hours.</span></span></code></pre></div>
<p>To tests for an interaction, it is important to use the coefficient
names that are internally created by the modeling function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#names(coef(lm_fit_interact))</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>boot_lm_interact <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  lm_fit_interact,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;log_income:Q1_immigration1&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><code>boottest()</code> further allows for multivariable tests.
Suppose we’re interested in testing the null hypothesis <span class="math inline">\(0.6*treatment + 0.2*ideology1 = 0.02\)</span>. To
test such a hypothesis, one would have to specify the hypothesis via the
<code>param</code>, <code>R</code> and <code>r</code> arguments:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>boot_multi <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="fu">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;ideology1&quot;</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.2</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="fl">0.02</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>To access the estimation results, <code>boottest()</code> comes with
<code>summary()</code>, <code>tidy()</code> and <code>glance()</code>
methods. The <code>tidy()</code> method returns the estimation results
in a data.frame. <code>summary()</code> returns additional information
on top of the test statistics reported by <code>tidy()</code>.
The<code>glance()</code> method enables the use of output formatting
tools from the <code>modelsummary</code> package.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fwildclusterboot&#39;s internal summary() method</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boot_lm)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; boottest.lm(object = lm_fit, param = &quot;treatment&quot;, B = 9999, clustid = &quot;group_id1&quot;)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Hypothesis: 1*treatment = 0</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Observations: 300</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Bootstr. Type: rademacher</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Clustering: 1-way</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Confidence Sets: 95%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Number of Clusters: 40</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              term estimate statistic p.value conf.low conf.high</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1*treatment = 0    0.073     3.709   0.001    0.033     0.113</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boot_multi)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; boottest.lm(object = lm_fit, param = c(&quot;treatment&quot;, &quot;ideology1&quot;), </span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     B = 9999, clustid = &quot;group_id1&quot;, R = c(0.6, 0.2), r = 0.02)</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Hypothesis: 0.6*treatment+0.2*ideology1 = 0.02</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Observations: 300</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Bootstr. Type: rademacher</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Clustering: 1-way</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Confidence Sets: 95%</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Number of Clusters: 40</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                 term estimate statistic p.value conf.low</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.6*treatment+0.2*ideology1 = 0.02    0.048     2.346   0.025    0.024</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   conf.high</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     0.072</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;modelsummary&quot;</span>)){</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summary via the modelsummary package</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(modelsummary)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">msummary</span>(<span class="fu">list</span>(boot_lm, boot_lm_interact), </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">estimate =</span> <span class="st">&quot;{estimate} ({p.value})&quot;</span>, </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">statistic =</span> <span class="st">&quot;[{conf.low}, {conf.high}]&quot;</span>)  </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required namespace: modelsummary</span></span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1*treatment = 0
</td>
<td style="text-align:center;">
0.073 (0.001)
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
[0.033, 0.113]
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
1*log_income × Q1_immigration1 = 0
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
−0.038 (0.000)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[−0.057, −0.019]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.339
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.311
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
−82.1
</td>
<td style="text-align:center;">
−92.2
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
−30.2
</td>
<td style="text-align:center;">
−40.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
60.102
</td>
</tr>
</tbody>
</table>
<p>A <code>plot()</code> method allows the user to inspect the bootstrap
t-statistics:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boot_lm)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAYFBMVEUAAAAAADoAAGYAAP8AOjoAOpAAZrY6AAA6ADo6AGY6kNtmAABmADpmtrZmtv+QOgCQkGaQ2/+2ZgC225C2/7a2///bkDrb25Db/7bb////AAD/tmb/25D//7b//9v////ZR5FuAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAIp0lEQVR4nO2di3aqOBhGsZ3WGT1jR2fqOR20vP9bHpIAgoZ8uXPx22u1y0vyJ25DEiBgUREjxdQVmDsUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAgQWVBh4tX4bgJMBU4lyPTma9yyMIYCVybI4Ru3LHA1gqQap23CrsC1CPLoNOwKXJUgtiBDvKLdxnxqk1/QqSjevz/q6h58wnn3QSiwR4FpBJ3fvmpH71V13e88wnkJsgnsUWASQd8ftZZyc6yUKudwqxd03ddbVvnyWbX/HcP59EF2kd0LXEsLWpagWx8kVTmHcxdUaB9as/5RrBh5bMn650EU5BBtWYLOWUaxwvDMhvm0ILtdyicWZBfOVVBhfGoBBQHyC5JDfM1IDxRX0EMsZ0P5J4pFMz8siwwTxeUJ6s2f0+9qaDp856NCk+ysKpLvrGqGRPfjimtuQYsUVPdBTRNK3wctU1C9kalRbKT9PHsfFBrOTZBzeKcCKQgUuHhBI4Hm3geFhVu6oLoHfvs6jQxP7uEeWbigcnOsZzejZ7xcw2lwEDQax8lQVEFiFiimf2OHwhzD6Vi2ILEfIQSN7UQ4htOxbEFtCzqNTgKdwulYtqCmDzqPntFxDKfBXpAhjIuh+KNYUcjzpv6sWlAMKCgknLUgYxSHGkcexQpwvNkUJe5pn1kKaggb5aO0IKDZ4aBHkk3s9G6b1blcO0GgIbocNksiaPKJ4twFTb6rMXNB1/3Um9hc+yB4uNktnA5bQcEJLApc8DzIokaT9kFhUFBIuGiCbGsdT1A3jfacSduVayXIqubZBUWDgkLCxRNkmSquoHYzw5vYZTt6UC1YkGXFpxB0evs6v5s+vE1PlUuQXbrIE8VdVYqzGoaZYrOoI2ELits1RD+rcfnrU/6Nct0LfXMQZJUy+lmN64+jWVC9IW6O6QS5rG+xSRu3DxK78aedcROTyYpdKkEuO+pWaSMP86d30Q3DQeyy/eNJBdny/TF+7oyCQsItuw9yO1KW5moft28rdyd9CjivGue0j2trzr+JleIjTnfIdf6CKtEDT3a4w707RDnyt6CkV/vMXJD87KAPSnu1j8eACrLkHsXSXqvhM+HIKUgwer8ARdqrfbxmZOZMuQUlbUF+M1bzxCK3oIRX+zhfp9JlM2XMLijZ1T7uVzpZ5csvyC3cPcsXFE5mQXn7ILn9hK1dyN0HgSKjr5Ou/5/D1gH7tqA0RUaeSasRaoqV9mHb+XjuuDPpH6rpTLAEL7QfHM2fpAWhg/aW4XQsW1A9+ROGJrhWI3wgHevi0ywkD1oB4ywoYPjqx9BHWcE8yHsCZBWEgkAQCrpFsS2wy2Id27k22ijeZzVi+JFxbAs0pQ9KGCGcrgUlLXn5giKWTkEeRS9eUNzCH7uzZQuK1T334t1HXLSgOAO8OSAFgYAUNCx7VYLi+2nCjhV4n9A6on9lnMO19U3jRhN8oYISNZ62Br3oFKSrwaSCoqwPWrGgKOuD0vpRE9BCTUNzCwpf3ZHYTa8esqTcgoLXB6VuPL16TCIooAWpFp9d0HhxqfogtD7o/8WQRJDP+qDi9iuOr9H34AGyyepHhUnnQU19bmoK2CWkofdDtF212srZxkggqKlQXw0cddPwel+RW3NKLch0MYu2QrK+fmX5c5uZVndf2KSnffotaHDgcCpBvTpma0HGcP0+qM+0gubTB40ysaABc95Zzcccd1ZNrP735i12NewCGwv1zehdoJnIO6t2gdcqiC0IgXdW7QKvVpDLvQSfU1CkwBQEAlMQCExBIDAFrQgKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEiCio7N8DrX0iz6SB47PajNVli25ZWA5vutbcx7gM/pm9AfEEiXt/lG3V2iffH/W/s/mDajPKm3+b76s2yCcOB8szLXevBhNNkDrl0fz4VvdE3VnZ+INK+ozqgSnjIJ9sOCLx3avhRBM0UHHnxfiN6jNe/kSNYFhGWezkuTqLb8SNeILkJ2pOKA6e1F+oqb76jOXLf3tz53VXRvPw4dVQoglSraRpK4Mn4CyaPuNZbDDfH4ZNZVhG1Vh5eDWUDIJK3EdrBG1QS1iaoNFNDJ2F1WdUvYjpVz6WtomNddJnNAvSZ1Qf0dRVP3THM++k9aO1xf2I9BnVShJTS3gY0Mt5D/P6+d5li+/MqJ8oivUj5vs63k8Jy3lPFEVjkXN8NfQ0T85qsYO5wrqM6ubW6M6pvXxdczvPdVdjpVAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAcxBUji8AMbxlnSKMGQjq3TPF4S3rFIFQEGB6QWJF/duvH/+IVZvndsnLqX5wUG/93P4t1ruKx+oX4mSS6168epApwn7YEzC9INkIrnvxMc/tkiu5Nq1+It66bOVifaFP/DVJrnvx6ub4BC2oESRbhWg95cun/EFKsdpQCdpV7b/DLcm+feFZBB3axbvNytZSbFFK0KHq/nVJZIb633MJau6/dhAdzcu/W52gNslzCmrXFnZORlpQk+npBHUfVq2Z121iXZLnErRr3MjrD06bo2o8xU6+NRDUJbkJCv0FeMAMBNWTnrdfqiGISY5anl9sjrUG8dbPgaA2SdfkTuufB80bCgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgI8BuNaRaemsbjhwAAAABJRU5ErkJggg==" /><!-- --></p>
<!-- A note on the output in `tidy()` and `summary()`: -->
<div id="multiway-clustering" class="section level2">
<h2>Multiway Clustering</h2>
<p>The <code>boottest()</code> function supports clustering of any
dimension. E.g. for two-way clustering, one simply needs to specify the
names of the cluster variables in a character vector.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>boot_lm <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  lm_fit,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boot_lm)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; boottest.lm(object = lm_fit, param = &quot;treatment&quot;, B = 9999, clustid = c(&quot;group_id1&quot;, </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &quot;group_id2&quot;))</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Hypothesis: 1*treatment = 0</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Observations: 300</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Bootstr. Type: rademacher</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Clustering: 2-way</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Confidence Sets: 95%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Number of Clusters: 40 20 253</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              term estimate statistic p.value conf.low conf.high</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1*treatment = 0    0.073     3.842   0.004    0.031     0.115</span></span></code></pre></div>
</div>
<div id="the-heteroskedastic-bootstrap" class="section level2">
<h2>The Heteroskedastic Bootstrap</h2>
<p>If you drop the <code>clustid</code> argument,
<code>boottest()</code> will run a heteroskedasticity robust wild
bootstrap via the ‘R-lean’ algorithm. At the moment, the null hypothesis
is always imposed, only Rademacher and Webb weights are supported, and
no confidence intervals are computed. Further, no regression weights are
supported. As all algorithms in <code>fwildclusterboot</code>, p-values
are calculated based on pivotal t-statistics.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>boot_lm <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  lm_fit,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boot_lm)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; boottest.lm(object = lm_fit, param = &quot;treatment&quot;, B = 9999)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Hypothesis: 1*treatment = 0</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Observations: 300</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Bootstr. Type: rademacher</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Clustering: 0-way</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Confidence Sets: 95%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              term estimate statistic p.value conf.low conf.high</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1*treatment = 0    0.073     3.096   0.002       NA        NA</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>boot_lm<span class="sc">$</span>engine</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;R-lean&quot;</span></span></code></pre></div>
</div>
<div id="choice-of-bootstrap-weights" class="section level2">
<h2>Choice of Bootstrap Weights</h2>
<p>Furthermore, the user can choose among four different weighting
distribution via the <code>type</code> argument: Rademacher, Mammen,
Normal and Webb. By default, <code>boottest()</code> uses the Rademacher
distribution.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>boot_lm_rade <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">999</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;rademacher&quot;</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>boot_lm_webb <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">999</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;webb&quot;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;modelsummary&quot;</span>)){</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(modelsummary)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">msummary</span>(<span class="fu">list</span>(boot_lm_rade, boot_lm_webb), </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">estimate =</span> <span class="st">&quot;{estimate} ({p.value})&quot;</span>, </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="st">&quot;[{conf.low}, {conf.high}]&quot;</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1*treatment = 0
</td>
<td style="text-align:center;">
0.073 (0.006)
</td>
<td style="text-align:center;">
0.073 (0.006)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.031, 0.115]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.029, 0.117]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
−82.1
</td>
<td style="text-align:center;">
−82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
−30.2
</td>
<td style="text-align:center;">
−30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
</div>
<div id="other-function-arguments" class="section level2">
<h2>Other function arguments</h2>
<p>Via the function argument <code>sign_level</code>, the user can
control the significance level of the test. The default value is
sign_level = 0.05, which corresponds to a 95% confindence interval.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>boot_lm_5 <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sign_level =</span> <span class="fl">0.05</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>boot_lm_10 <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sign_level =</span> <span class="fl">0.10</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;modelsummary&quot;</span>)){</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(modelsummary)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">msummary</span>(<span class="fu">list</span>(boot_lm_5, boot_lm_10), </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">estimate =</span> <span class="st">&quot;{estimate} ({p.value})&quot;</span>, </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="st">&quot;[{conf.low}, {conf.high}]&quot;</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1*treatment = 0
</td>
<td style="text-align:center;">
0.073 (0.000)
</td>
<td style="text-align:center;">
0.073 (0.001)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.033, 0.113]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.040, 0.106]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
−82.1
</td>
<td style="text-align:center;">
−82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
−30.2
</td>
<td style="text-align:center;">
−30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
<p>In the case of multiway clustering, the user might want to specify
the bootstrap clustering level. By default, boottest chooses the
clustering level with the highest number of clusters as
<code>bootcluster = &quot;max&quot;</code>. Other choices are the minimum cluster,
or independent clustering variables.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>boot_lm1 <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bootcluster =</span> <span class="st">&quot;min&quot;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>boot_lm2 <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">bootcluster =</span> <span class="st">&quot;group_id1&quot;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;modelsummary&quot;</span>)){</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(modelsummary)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">msummary</span>(<span class="fu">list</span>(boot_lm1, boot_lm2), </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">estimate =</span> <span class="st">&quot;{estimate} ({p.value})&quot;</span>, </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="st">&quot;[{conf.low}, {conf.high}]&quot;</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1*treatment = 0
</td>
<td style="text-align:center;">
0.073 (0.005)
</td>
<td style="text-align:center;">
0.073 (0.008)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.031, 0.111]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.027, 0.115]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
−82.1
</td>
<td style="text-align:center;">
−82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
−30.2
</td>
<td style="text-align:center;">
−30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
</div>
<div id="fixed-effects" class="section level2">
<h2>Fixed Effects</h2>
<p>Last, <code>boottest()</code> supports out-projection of fixed
effects in the estimation stage via <code>lfe::felm()</code> and
<code>fixest::feols()</code>. Within the bootstrap, the user can choose
to project out <em>only one</em> fixed effect, which can be set via the
<code>fe</code> function argument. All other fixed effects specified in
either <code>felm()</code> or <code>feols()</code> are treated as sets
of binary regressors.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;fixest&quot;</span>)){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate the regression model via feols</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(fixest)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  feols_fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    proposition_vote <span class="sc">~</span> treatment <span class="sc">+</span> ideology1 <span class="sc">+</span> log_income <span class="sc">|</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      Q1_immigration , </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> voters</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  boot_feols <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    feols_fit, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fe =</span> <span class="st">&quot;Q1_immigration&quot;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required namespace: fixest</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;fixest&#39; was built under R version 4.2.3</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; To guarantee reproducibility, don&#39;t forget to set a global random seed **both**</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; via `set.seed()` and `dqrng::dqset.seed()`.</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This message is displayed once every 8 hours.</span></span></code></pre></div>
</div>
<div id="the-subcluster-bootstrap" class="section level2">
<h2>The Subcluster Bootstrap</h2>
<p>In the case of few treated clusters, <a href="https://academic.oup.com/ectj/article-abstract/21/2/114/5078969">MacKinnon
and Webb (2018)</a> suggest to use subclusters to form the bootstrap
distribution. <code>boottest()</code> allows the user to specify
subclusters via the <code>bootcluster</code> argument.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>boot_min <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  lm_fit,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bootcluster =</span> <span class="st">&quot;min&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>boot_var <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  lm_fit,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">bootcluster =</span> <span class="st">&quot;group_id1&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>boot_2var <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  lm_fit,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;group_id2&quot;</span>), </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">bootcluster =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>, <span class="st">&quot;Q1_immigration&quot;</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">requireNamespace</span>(<span class="st">&quot;modelsummary&quot;</span>)){</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(modelsummary)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">msummary</span>(<span class="at">model =</span> <span class="fu">list</span>(boot_min, boot_2var), </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="st">&quot;{estimate} ({p.value})&quot;</span>, </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="st">&quot;[{conf.low}, {conf.high}]&quot;</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1*treatment = 0
</td>
<td style="text-align:center;">
0.073 (0.003)
</td>
<td style="text-align:center;">
0.073 (0.010)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.032, 0.110]
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[0.027, 0.119]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
300
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.316
</td>
<td style="text-align:center;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.288
</td>
<td style="text-align:center;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
−82.1
</td>
<td style="text-align:center;">
−82.1
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
−30.2
</td>
<td style="text-align:center;">
−30.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
55.025
</td>
<td style="text-align:center;">
55.025
</td>
</tr>
</tbody>
</table>
</div>
<div id="regression-weights-weighted-least-squares-wls" class="section level2">
<h2>Regression Weights / Weighted Least Squares (WLS)</h2>
<p>If regression weights are specified in the estimation stage via
<code>lm()</code>, <code>feols()</code> or <code>felm()</code>,
<code>boottest()</code> incorporates the weights into the bootstrap
inference:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regression with weights / WLS</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lm_w_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  proposition_vote <span class="sc">~</span> treatment <span class="sc">+</span> ideology1 <span class="sc">+</span> log_income,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> voters<span class="sc">$</span>weights,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> voters</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>boot_w_lm <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  lm_w_fit, </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="parallel-execution" class="section level2">
<h2>Parallel Execution</h2>
<p>A major bottleneck for the performance of <code>boottest()</code> is
a large matrix multiplication, which includes the bootstrap weights
matrix on the right. In order to speed up the computation, this
multiplication calls the c++ Eigen library, which allows for
parallelization of dense matrix products. By default,
<code>boottest()</code> uses one thread. Note that there is a cost of
parallelization due to communication overhead. As a rule of thumb, if
<code>boottest()</code> takes more than 10 seconds per execution, using
a second thread might speed up the bootstrap.</p>
<p>The number of threads can be specified via the <code>nthreads</code>
argument of <code>boottest()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>boot_lm <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthreads =</span> <span class="dv">2</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="running-the-wild-cluster-bootstrap-via-wildboottests.jl" class="section level1">
<h1>Running the wild cluster bootstrap via WildBootTests.jl</h1>
<p><code>fwildclusterboot</code> serves as an R port to the <a href="https://github.com/droodman/WildBootTests.jl">WildBootTests.jl</a>
package.</p>
<p>For guidance on how to install <code>Julia</code> and
<code>WildBootTests.jl</code> and how to connect R and Julia, please
take a look at the <a href="https://s3alfisc.github.io/fwildclusterboot/articles/WildBootTests.html">running
WildBootTests.jl through fwildclusterboot</a> vignette.</p>
<p>You can tell <code>boottest()</code> to run
<code>WildBootTests.jl</code> by using the <code>engine</code> function
argument:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>boot_lm <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  lm_fit, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">engine =</span> <span class="st">&quot;WildBootTests.jl&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(boot_lm)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#             term   estimate statistic    p.value   conf.low conf.high</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#1 1*treatment = 0 0.07290769  3.709435 0.00060006 0.03326969 0.1134117</span></span></code></pre></div>
<p>The seed used within Julia is linked to R’s global seed, which you
can set through the familiar <code>set.seed()</code> function.</p>
<p>If you decide to run all your bootstraps through
<code>WildBootTests.jl</code>, you can set a global variable via</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setBoottest_engine</span>(<span class="st">&quot;WildBootTests.jl&quot;</span>)</span></code></pre></div>
<p>Calling <code>boottest()</code> without specifying
<code>engine = &quot;WildBootTests.jl&quot;</code> will now automatically run the
bootstrap through <code>WildBootTests.jl</code>.</p>
<div id="the-wre-bootstrap-for-iv-models" class="section level2">
<h2>The WRE bootstrap for IV models</h2>
<p>Through <code>WildBootTests.jl</code>, <code>fwildclusterboot</code>
supports the WRE bootstrap by <a href="https://www.tandfonline.com/doi/abs/10.1198/jbes.2009.07221">Davidson
&amp; MacKinnon, 2010</a> for IV (instrumental variables) models for
objects of type <code>ivreg</code> via the <code>boottest()</code>
function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ivreg)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;SchoolingReturns&quot;</span>, <span class="at">package =</span> <span class="st">&quot;ivreg&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># drop all NA values from SchoolingReturns</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>SchoolingReturns <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(SchoolingReturns)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ivreg_fit <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(wage) <span class="sc">~</span> education <span class="sc">+</span> age <span class="sc">+</span> ethnicity <span class="sc">+</span> smsa <span class="sc">+</span> south <span class="sc">+</span> parents14 <span class="sc">|</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>              nearcollege <span class="sc">+</span> age  <span class="sc">+</span> ethnicity <span class="sc">+</span> smsa <span class="sc">+</span> south <span class="sc">+</span> parents14, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> SchoolingReturns)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>boot_ivreg <span class="ot">&lt;-</span> <span class="fu">boottest</span>(</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> ivreg_fit,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">999</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">param =</span> <span class="st">&quot;education&quot;</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;kww&quot;</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;mammen&quot;</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">impose_null =</span> <span class="cn">TRUE</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(boot_ivreg)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">#              term  estimate statistic   p.value    conf.low conf.high</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 1*education = 0 0.0638822  1.043969 0.2482482 -0.03152655 0.2128746</span></span></code></pre></div>
</div>
<div id="tests-of-multiple-joint-hypotheses-q-1" class="section level2">
<h2>Tests of multiple joint hypotheses (q &gt; 1)</h2>
<p>Through <code>WildBootTests.jl</code>, you can also test multiple
joint hypotheses via the <code>mboottest()</code> function. With minor
differences, <code>mboottest()&#39;s</code> syntax largely mirrors
<code>boottest()</code>.</p>
<p>To jointly test the null hypothesis <span class="math inline">\(H_0:
treatment = 0 \text{ and } ideology1 = 0\)</span> vs <span class="math inline">\(H_0: treatment \neq 0 \text{ and } ideology1 \neq
0\)</span> via a wild cluster bootstrap, you can run</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clubSandwich)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> clubSandwich<span class="sc">::</span><span class="fu">constrain_zero</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">coef</span>(lm_fit))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>wboottest <span class="ot">&lt;-</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mboottest</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> lm_fit, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="dv">999</span>, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> R</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(wboottest)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   teststat p_val</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 8.469086     0</span></span></code></pre></div>
</div>
</div>
<div id="miscellanea" class="section level1">
<h1>Miscellanea</h1>
<!-- ## Why does `boottest()` not compute standard errors? -->
<!-- ## A note on performance -->
<!-- ## Inversion of p-values -->
<!-- ### How it works: make use of linearity of both the numerator and J -->
<!-- The starting point of this section are equations (56, 58 and 62) in Roodman et al. They show that once can write the numerator as (eq. 56) -->
<!-- $$ -->
<!--   R(\hat{\beta}^{*} - \tilde{\beta}) = \{S_{c_{*}} [WDXAR' :* \tilde{u}] \}' v^{*}. -->
<!-- $$ -->
<!-- The denominator can be written as (eq. 60) -->
<!-- $$ -->
<!-- $$ -->
<!-- where the object $K$ can be computed as  -->
<!-- $$ -->
<!-- $$ -->
<!-- For univariate hypotheses, both numerator and J are linear in $r$.  -->
<!-- Note that several objects used in the computation of both numerator and J can be written as $\ü :* A$ or $\ü * A$, where $A$ is and $ü$ is .... All derivations are shown for the first case, while the main conclusions apply to the second as well.  -->
<!-- First, for the WCU, it holds that  -->
<!-- \begin{align} -->
<!--     \ü :* A &= (Y - X'\beta) :* A \\ -->
<!--       &= Y :* A - X'\beta :* A \\ -->
<!--       &= Y :* A - X'(X'X)^{-1}X Y :* A \\ -->
<!--       &=  ((1 :- P_{x}) Y) :* A  -->
<!-- \end{align} -->
<!-- For the WCR, the analogous derivation are slightly more complicated:  -->
<!-- \begin{align} -->
<!--   \tilde{u} :* A &= (Y_{r} - X_{r}'\beta_{r}) :* A \\ -->
<!--           &= Y_{r} :* A - X_{r}'\beta_{r} :* A \\ -->
<!--           &= Y_{r} :* A - X_{r}'(X_{r}'X_{r})^{-1}X_{r} Y_{r} :* A \\ -->
<!--           &= Y_{r} :* A - P_{xr} Y_{r} :* A \\ -->
<!-- \end{align} -->
<!-- Now, note that $Y_r = Y - X_0 r$, it follows that  -->
<!-- \begin{align} -->
<!--   \tilde{u} :* A &= Y_{r} :* A - P_{xr} Y_{r} :* A \\  -->
<!--             &= (Y - X_{0} r) :* A - P_{xr} (Y - X_{0} r) :* A \\ -->
<!--             &= Y :* A - X_{0} r :* A - (P_{xr} Y) :* A +  P_{xr}  X_{0} r :*A \\  -->
<!--             &=  Y :* A  - (P_{xr} Y) :* A - P_{xr}  X_{0} r :* A + X_{0} r :* A \\ -->
<!--             &= (Y - P_{xr} Y) :* A + (X_{0} r -P_{xr}  X_{0} r) :* A \\  -->
<!--             &= (1 :- P_{xr})Y :* A + ((1 :- P_{xr})  X_{0}) :* A * r \\ -->
<!--             &= P + Q r -->
<!-- \end{align} -->
<!-- where  -->
<!-- $$ -->
<!--   P = (1 :- P_{xr})Y -->
<!-- $$ -->
<!-- and  -->
<!-- $$ -->
<!--   Q = ((1 :- P_{xr})  X_{0}). -->
<!-- $$ -->
<!-- Both quantities, $P$ and $Q$, are explicitely computed as such in the engine2 function. Q summarizes all terms that vary in $r$, while P summarizes constant terms.  -->
<!-- Note that in the case of the WCU, $X_r = X$, $P_{xr} = P_{x}$, and $X_0$ is a vector of length N, containing zeros.  -->
<!-- Therefore, the following quantities need to be computed:  -->
<!-- + $X_r$ -->
<!-- + $P_{xr}$ -->
<!-- + $X_0$ -->
<!-- + several different object for $A$ -->
<!-- Based on these objects, one can e.g. compute -->
<!-- \begin{align} -->
<!-- S_{c, c*}[\tilde{u} :* A] &= S_{c, c*}[(1 :- P_{xr})Y :* A] + S_{c, c*}[((1 :- P_{xr})  X_{0}) :* A]  r \\ -->
<!-- &= P_{1} + Q_{1} r -->
<!-- \end{align} -->
<!-- For K, one can then write an expression of the form  -->
<!-- \begin{align} -->
<!--   K &= (P_1 + P_2 + P_3) + (Q_1 + Q_2 +   Q_3) r  -->
<!-- \end{align} -->
<!-- For $J$, it follows that  -->
<!-- \begin{align} -->
<!--   J = K v & = (P_1 + P_2 + P_3) v + (Q_1 + Q_2 +   Q_3) v \times r \\ -->
<!--   &= C + D \times r -->
<!-- \end{align} -->
<!-- For $J :* J$, it hence follows  -->
<!-- $$ -->
<!--   J :* J = C :* C  + 2 C :* D \times r + D :* D \times r^{2} -->
<!-- $$ -->
<!-- So, in short: one can simply compute C, D, CC, CD and DD once and then invert the p-value by searching over r.  -->
<!-- Again, note that for for the WCU, $X_0 = 0$, which implies that in the equations above, all elements in $Q$, $Q1$, $Q2$, $Q3$, $D$, $CD$ and $DD$ are zero. In consequence, for the WCU, the numerator can be computed as  -->
<!-- $$ -->
<!-- $$ -->
<!-- and the denominator is  -->
<!-- $$ -->
<!-- $$ -->
<!-- For the WCU, both numerator and denominator do not depend on $r$. -->
<!-- + why might confidence intervals differ for estimates based on `lm()`, `feols()` and `felm()`? -->
<div id="a-sanity-check-if-fwildclusterbootboottest-works-as-intended" class="section level2">
<h2>A sanity check if <code>fwildclusterboot::boottest()</code> works as
intended</h2>
<p>A sanity check to see if <code>fwildclusterboot::boottest()</code>
works as intended is to look at its <code>t_stat</code> return value.
For both the WCR and WCU bootstrap, <code>boottest()</code>
re-calculates the “original” - hence non-bootstrapped - t-statistic from
its input regression model. The t-stat computed in
<code>boottest()</code> and the t-stats reported by either
<code>lm()</code>, <code>feols()</code> and <code>lfe()</code> under the
same error clustering structure and small-sample adjustments should be
<em>identical</em>. If you find that they differ, please report a bug <a href="https://github.com/s3alfisc/fwildclusterboot/issues">on
github</a>. Note that <code>fwildclusterboot</code> explicitly tests for
t-stat equality against <code>fixest::feols()</code> <a href="https://github.com/s3alfisc/fwildclusterboot/blob/master/tests/testthat/test-tstat_equivalence.R">here</a>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fwildclusterboot<span class="sc">:::</span><span class="fu">create_data</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">1000</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_G1 =</span> <span class="dv">20</span>, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">icc1 =</span> <span class="fl">0.81</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_G2 =</span> <span class="dv">10</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">icc2 =</span> <span class="fl">0.01</span>, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">numb_fe1 =</span> <span class="dv">10</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">numb_fe2 =</span> <span class="dv">10</span>, </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">8769</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># oneway clustering </span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>feols_fit <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  proposition_vote <span class="sc">~</span> treatment <span class="sc">+</span> ideology1 <span class="sc">+</span> log_income,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data, </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> <span class="sc">~</span>group_id1, </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ssc =</span> fixest<span class="sc">::</span><span class="fu">ssc</span>(<span class="at">adj =</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cluster.adj =</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cluster.df =</span> <span class="st">&#39;conventional&#39;</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>feols_tstats <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">coeftable</span>(</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  feols_fit</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  )[<span class="fu">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;log_income&quot;</span>, <span class="st">&quot;ideology1&quot;</span>), <span class="dv">3</span>]</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>boot_tstats <span class="ot">&lt;-</span> </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;log_income&quot;</span>, <span class="st">&quot;ideology1&quot;</span>), <span class="cf">function</span>(x){</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  boot1 <span class="ot">&lt;-</span> fwildclusterboot<span class="sc">::</span><span class="fu">boottest</span>(</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    feols_fit, </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">clustid =</span> <span class="fu">c</span>(<span class="st">&quot;group_id1&quot;</span>),</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">B =</span> <span class="dv">999</span>, </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">param =</span> x, </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">ssc =</span> fwildclusterboot<span class="sc">::</span><span class="fu">boot_ssc</span>(</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">adj =</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">cluster.adj =</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">cluster.df =</span> <span class="st">&#39;conventional&#39;</span>),  </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">impose_null =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>t_stat</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>})        </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(feols_tstats, <span class="fu">unlist</span>(boot_tstats))</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;feols tstat&quot;</span>, <span class="st">&quot;boottest tstat&quot;</span>)</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            feols tstat boottest tstat</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; treatment    0.9958071      0.9958071</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; log_income  -2.9129869     -2.9129869</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ideology1    1.4169933      1.4169933</span></span></code></pre></div>
</div>
<div id="small-sample-corrections" class="section level2">
<h2>Small Sample Corrections</h2>
<p><code>boottest()</code> offers several options for small sample
adjustments via the <code>ssc</code> function argument which need to be
specified via the <code>boot_ssc()</code> function.
<code>boot_ssc()</code> has 4 arguments and is intentionally designed to
mimic <code>fixest&#39;s</code> <code>ssc()</code> function. For more
information on the default choices and alternative options, see
<code>?fwildclusterboot::boot_ssc()</code>.</p>
</div>
<div id="memory-the-lean-implementation-of-the-wild-cluster-bootstrap" class="section level2">
<h2>Memory &amp; the ‘lean’ implementation of the wild cluster
bootstrap</h2>
<p>Because the R-implementation of the fast algorithm is
memory-intensive, <code>fwildclusterboot</code> further supports a
Rcpp-based ‘lean’ implementation of the wild cluster bootstrap in case
that memory demands get prohibitively large. In general, the ‘lean’
algorithm is much slower: its main feature is that it requires
<em>much</em> less memory. The algorithm is equivalent to the ‘wild2’
algorithm in the “Fast &amp; Wild” paper by Roodman et al. Note that the
implementation in <code>WildBootTests.jl</code> is, in general, very
memory-efficient.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> fwildclusterboot<span class="sc">:::</span><span class="fu">create_data</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">10000</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_G1 =</span> <span class="dv">250</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">icc1 =</span> <span class="fl">0.01</span>, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_G2 =</span> <span class="dv">10</span>, </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">icc2 =</span> <span class="fl">0.01</span>, </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">numb_fe1 =</span> <span class="dv">10</span>, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">numb_fe2 =</span> <span class="dv">10</span>, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7645</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  proposition_vote <span class="sc">~</span> treatment <span class="sc">+</span> ideology1 <span class="sc">+</span> log_income <span class="sc">+</span> Q1_immigration ,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;R&quot;</span> <span class="ot">=</span> <span class="fu">boottest</span>(lm_fit, </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">engine =</span> <span class="st">&quot;R&quot;</span>, </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">nthreads =</span> <span class="dv">4</span>), </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;R-lean&quot;</span> <span class="ot">=</span> <span class="fu">boottest</span>(lm_fit, </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">engine =</span> <span class="st">&quot;R-lean&quot;</span>, </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">nthreads =</span> <span class="dv">4</span>),</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;WildBootTests.jl&quot;</span> <span class="ot">=</span> </span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">boottest</span>(lm_fit, </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">clustid =</span> <span class="st">&quot;group_id1&quot;</span>, </span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">param =</span> <span class="st">&quot;treatment&quot;</span>, </span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">B =</span> <span class="dv">9999</span>, </span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">engine =</span> <span class="st">&quot;WildBootTests.jl&quot;</span>), </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="dv">1</span>, </span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">check =</span> <span class="cn">FALSE</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
</div>
<div id="seeds" class="section level2">
<h2>Seeds</h2>
<p>To guarantee reproducibility, you need to set a global random seed
via</p>
<ul>
<li><code>set.seed()</code> when using
<ol style="list-style-type: decimal">
<li>the lean algorithm (via <code>engine = &quot;R-lean&quot;</code>),</li>
<li>the heteroskedastic wild bootstrap</li>
<li>the wild cluster bootstrap via <code>engine = &quot;R&quot;</code> with Mammen
weights or</li>
<li><code>engine = &quot;WildBootTests.jl&quot;</code></li>
</ol></li>
<li><code>dqrng::dqset.seed()</code> when using
<code>engine = &quot;R&quot;</code> for Rademacher, Webb or Normal weights</li>
</ul>
</div>
<div id="treatment-of-invalid-test-statistics-for-multiway-clustering" class="section level2">
<h2>Treatment of Invalid Test Statistics for multiway clustering</h2>
<p>In case of multi-way clustering, it is not guaranteed that the
covariance matrix is positive definite, in which case the resulting
bootstrap test statistics are invalid. <code>boottest()</code> follows
the implementation in STATA and deletes invalid tests statistics, and
informs the user with a note.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
